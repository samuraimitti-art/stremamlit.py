"""
ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€Webã‚¢ãƒ—ãƒªã®ãƒ¡ã‚¤ãƒ³å‡¦ç†ãŒè¨˜è¿°ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚
"""

############################################################
# 1. ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®èª­ã¿è¾¼ã¿
############################################################
import streamlit as st
from initialize import initialize
import utils
import constants as ct

# ============================================================
# åˆæœŸè¨­å®š
# ============================================================
try:
    initialize()
except Exception as e:
    st.error(ct.INITIALIZE_ERROR_MESSAGE)
    st.stop()

# ãƒšãƒ¼ã‚¸è¨­å®š
st.set_page_config(
    page_title=ct.APP_NAME,
    layout="wide",
    initial_sidebar_state="expanded"
)

# ============================================================
# ã‚¿ã‚¤ãƒˆãƒ«
# ============================================================
st.title("ç¤¾å†…æƒ…å ±ç‰¹åŒ–å‹ç”ŸæˆAIæ¤œç´¢ã‚¢ãƒ—ãƒª")

# ============================================================
# ã‚µã‚¤ãƒ‰ãƒãƒ¼
# ============================================================
st.sidebar.title("åˆ©ç”¨ç›®çš„")

answer_mode = st.sidebar.radio(
    "åˆ©ç”¨ç›®çš„ã‚’é¸æŠã—ã¦ãã ã•ã„ï¼š",
    [ct.ANSWER_MODE_1, ct.ANSWER_MODE_2],
    index=0
)
st.session_state.answer_mode = answer_mode

st.sidebar.markdown("----")

if answer_mode == ct.ANSWER_MODE_1:
    st.sidebar.markdown("### ğŸ—‚ã€Œç¤¾å†…æ–‡æ›¸æ¤œç´¢ã€ã‚’é¸æŠã—ãŸå ´åˆ")
    st.sidebar.info("å…¥åŠ›å†…å®¹ã¨é–¢é€£æ€§ãŒé«˜ã„ç¤¾å†…æ–‡æ›¸ã®ã‚ã‚Šã‹ã‚’æ¤œç´¢ã§ãã¾ã™ã€‚")
    st.sidebar.caption("ã€å…¥åŠ›ä¾‹ã€‘ç¤¾å“¡ã®è‚²æˆæ–¹é‡ã«é–¢ã™ã‚‹MTGã®è­°äº‹éŒ²")
else:
    st.sidebar.markdown("### ğŸ’¬ã€Œç¤¾å†…å•ã„åˆã‚ã›ã€ã‚’é¸æŠã—ãŸå ´åˆ")
    st.sidebar.info("è³ªå•ãƒ»è¦æœ›ã«å¯¾ã—ã¦ã€ç¤¾å†…æ–‡æ›¸ã®æƒ…å ±ã‚’ã‚‚ã¨ã«å›ç­”ã‚’å¾—ã‚‰ã‚Œã¾ã™ã€‚")
    st.sidebar.caption("ã€å…¥åŠ›ä¾‹ã€‘äººäº‹éƒ¨ã«æ‰€å±ã—ã¦ã„ã‚‹å¾“æ¥­å“¡æƒ…å ±ã‚’ä¸€è¦§åŒ–ã—ã¦")

# ============================================================
# ãƒ¡ã‚¤ãƒ³ç”»é¢ï¼ˆå³å´ï¼‰
# ============================================================

# ã‚°ãƒªãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆç·‘ãƒœãƒƒã‚¯ã‚¹ï¼‰
st.markdown(
    """
    <div style="background-color:#E8F5E9; padding:15px; border-radius:10px; margin-bottom:10px;">
        <b>ğŸ‘‹ ã“ã‚“ã«ã¡ã¯ã€‚</b><br>
        ç§ã¯ã€ç¤¾å†…æ–‡æ›¸ã®æƒ…å ±ã‚’ã‚‚ã¨ã«å›ç­”ã™ã‚‹ç”ŸæˆAIãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã§ã™ã€‚<br>
        ã‚µã‚¤ãƒ‰ãƒãƒ¼ã§åˆ©ç”¨ç›®çš„ã‚’é¸æŠã—ã€ç”»é¢ä¸‹éƒ¨ã®ãƒãƒ£ãƒƒãƒˆæ¬„ã‹ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã¦ãã ã•ã„ã€‚
    </div>
    """,
    unsafe_allow_html=True
)

# æ³¨æ„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆé»„è‰²ãƒœãƒƒã‚¯ã‚¹ï¼‰
st.markdown(
    """
    <div style="background-color:#FFF8E1; padding:15px; border-radius:10px; margin-bottom:20px;">
        âš ï¸ <b>å…·ä½“çš„ã«å…¥åŠ›ã—ãŸã»ã†ãŒæœŸå¾…é€šã‚Šã®å›ç­”ã‚’å¾—ã‚„ã™ã„ã§ã™ã€‚</b>
    </div>
    """,
    unsafe_allow_html=True
)

# ãƒãƒ£ãƒƒãƒˆå±¥æ­´
for msg in st.session_state.messages:
    with st.chat_message(msg["role"]):
        st.markdown(msg["content"])

# å…¥åŠ›æ¬„
user_input = st.chat_input("ã“ã¡ã‚‰ã‹ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã¦ãã ã•ã„ã€‚")

if user_input:
    st.session_state.messages.append({"role": "user", "content": user_input})
    with st.chat_message("user"):
        st.markdown(user_input)

    response = utils.handle_user_input(user_input)

    st.session_state.messages.append({"role": "assistant", "content": response})
    with st.chat_message("assistant"):
        st.markdown(response)
"""
ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€Webã‚¢ãƒ—ãƒªã®ãƒ¡ã‚¤ãƒ³å‡¦ç†ãŒè¨˜è¿°ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚
"""

############################################################
# 1. ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®èª­ã¿è¾¼ã¿
############################################################
import streamlit as st
from initialize import initialize
import utils
import constants as ct

# ============================================================
# åˆæœŸè¨­å®š
# ============================================================
try:
    initialize()
except Exception as e:
    st.error(ct.INITIALIZE_ERROR_MESSAGE)
    st.stop()

# ãƒšãƒ¼ã‚¸è¨­å®š
st.set_page_config(
    page_title=ct.APP_NAME,
    layout="wide",
    initial_sidebar_state="expanded"
)

# ============================================================
# ã‚¿ã‚¤ãƒˆãƒ«
# ============================================================
st.title("ç¤¾å†…æƒ…å ±ç‰¹åŒ–å‹ç”ŸæˆAIæ¤œç´¢ã‚¢ãƒ—ãƒª")

# ============================================================
# ã‚µã‚¤ãƒ‰ãƒãƒ¼
# ============================================================
st.sidebar.title("åˆ©ç”¨ç›®çš„")

answer_mode = st.sidebar.radio(
    "åˆ©ç”¨ç›®çš„ã‚’é¸æŠã—ã¦ãã ã•ã„ï¼š",
    [ct.ANSWER_MODE_1, ct.ANSWER_MODE_2],
    index=0
)
st.session_state.answer_mode = answer_mode

st.sidebar.markdown("----")

if answer_mode == ct.ANSWER_MODE_1:
    st.sidebar.markdown("### ğŸ—‚ã€Œç¤¾å†…æ–‡æ›¸æ¤œç´¢ã€ã‚’é¸æŠã—ãŸå ´åˆ")
    st.sidebar.info("å…¥åŠ›å†…å®¹ã¨é–¢é€£æ€§ãŒé«˜ã„ç¤¾å†…æ–‡æ›¸ã®ã‚ã‚Šã‹ã‚’æ¤œç´¢ã§ãã¾ã™ã€‚")
    st.sidebar.caption("ã€å…¥åŠ›ä¾‹ã€‘ç¤¾å“¡ã®è‚²æˆæ–¹é‡ã«é–¢ã™ã‚‹MTGã®è­°äº‹éŒ²")
else:
    st.sidebar.markdown("### ğŸ’¬ã€Œç¤¾å†…å•ã„åˆã‚ã›ã€ã‚’é¸æŠã—ãŸå ´åˆ")
    st.sidebar.info("è³ªå•ãƒ»è¦æœ›ã«å¯¾ã—ã¦ã€ç¤¾å†…æ–‡æ›¸ã®æƒ…å ±ã‚’ã‚‚ã¨ã«å›ç­”ã‚’å¾—ã‚‰ã‚Œã¾ã™ã€‚")
    st.sidebar.caption("ã€å…¥åŠ›ä¾‹ã€‘äººäº‹éƒ¨ã«æ‰€å±ã—ã¦ã„ã‚‹å¾“æ¥­å“¡æƒ…å ±ã‚’ä¸€è¦§åŒ–ã—ã¦")

# ============================================================
# ãƒ¡ã‚¤ãƒ³ç”»é¢ï¼ˆå³å´ï¼‰
# ============================================================

# ã‚°ãƒªãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆç·‘ãƒœãƒƒã‚¯ã‚¹ï¼‰
st.markdown(
    """
    <div style="background-color:#E8F5E9; padding:15px; border-radius:10px; margin-bottom:10px;">
        <b>ğŸ‘‹ ã“ã‚“ã«ã¡ã¯ã€‚</b><br>
        ç§ã¯ã€ç¤¾å†…æ–‡æ›¸ã®æƒ…å ±ã‚’ã‚‚ã¨ã«å›ç­”ã™ã‚‹ç”ŸæˆAIãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã§ã™ã€‚<br>
        ã‚µã‚¤ãƒ‰ãƒãƒ¼ã§åˆ©ç”¨ç›®çš„ã‚’é¸æŠã—ã€ç”»é¢ä¸‹éƒ¨ã®ãƒãƒ£ãƒƒãƒˆæ¬„ã‹ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã¦ãã ã•ã„ã€‚
    </div>
    """,
    unsafe_allow_html=True
)

# æ³¨æ„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆé»„è‰²ãƒœãƒƒã‚¯ã‚¹ï¼‰
st.markdown(
    """
    <div style="background-color:#FFF8E1; padding:15px; border-radius:10px; margin-bottom:20px;">
        âš ï¸ <b>å…·ä½“çš„ã«å…¥åŠ›ã—ãŸã»ã†ãŒæœŸå¾…é€šã‚Šã®å›ç­”ã‚’å¾—ã‚„ã™ã„ã§ã™ã€‚</b>
    </div>
    """,
    unsafe_allow_html=True
)

# ãƒãƒ£ãƒƒãƒˆå±¥æ­´
for msg in st.session_state.messages:
    with st.chat_message(msg["role"]):
        st.markdown(msg["content"])

# å…¥åŠ›æ¬„
user_input = st.chat_input("ã“ã¡ã‚‰ã‹ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã¦ãã ã•ã„ã€‚")

if user_input:
    st.session_state.messages.append({"role": "user", "content": user_input})
    with st.chat_message("user"):
        st.markdown(user_input)

    response = utils.handle_user_input(user_input)

    st.session_state.messages.append({"role": "assistant", "content": response})
    with st.chat_message("assistant"):
        st.markdown(response)
"""
ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€Webã‚¢ãƒ—ãƒªã®ãƒ¡ã‚¤ãƒ³å‡¦ç†ãŒè¨˜è¿°ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚
"""

############################################################
# 1. ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®èª­ã¿è¾¼ã¿
############################################################
import streamlit as st
from initialize import initialize
import utils
import constants as ct

# ============================================================
# åˆæœŸè¨­å®š
# ============================================================
try:
    initialize()
except Exception as e:
    st.error(ct.INITIALIZE_ERROR_MESSAGE)
    st.stop()

# ãƒšãƒ¼ã‚¸è¨­å®š
st.set_page_config(
    page_title=ct.APP_NAME,
    layout="wide",
    initial_sidebar_state="expanded"
)

# ============================================================
# ã‚¿ã‚¤ãƒˆãƒ«
# ============================================================
st.title("ç¤¾å†…æƒ…å ±ç‰¹åŒ–å‹ç”ŸæˆAIæ¤œç´¢ã‚¢ãƒ—ãƒª")

# ============================================================
# ã‚µã‚¤ãƒ‰ãƒãƒ¼
# ============================================================
st.sidebar.title("åˆ©ç”¨ç›®çš„")

answer_mode = st.sidebar.radio(
    "åˆ©ç”¨ç›®çš„ã‚’é¸æŠã—ã¦ãã ã•ã„ï¼š",
    [ct.ANSWER_MODE_1, ct.ANSWER_MODE_2],
    index=0
)
st.session_state.answer_mode = answer_mode

st.sidebar.markdown("----")

if answer_mode == ct.ANSWER_MODE_1:
    st.sidebar.markdown("### ğŸ—‚ã€Œç¤¾å†…æ–‡æ›¸æ¤œç´¢ã€ã‚’é¸æŠã—ãŸå ´åˆ")
    st.sidebar.info("å…¥åŠ›å†…å®¹ã¨é–¢é€£æ€§ãŒé«˜ã„ç¤¾å†…æ–‡æ›¸ã®ã‚ã‚Šã‹ã‚’æ¤œç´¢ã§ãã¾ã™ã€‚")
    st.sidebar.caption("ã€å…¥åŠ›ä¾‹ã€‘ç¤¾å“¡ã®è‚²æˆæ–¹é‡ã«é–¢ã™ã‚‹MTGã®è­°äº‹éŒ²")
else:
    st.sidebar.markdown("### ğŸ’¬ã€Œç¤¾å†…å•ã„åˆã‚ã›ã€ã‚’é¸æŠã—ãŸå ´åˆ")
    st.sidebar.info("è³ªå•ãƒ»è¦æœ›ã«å¯¾ã—ã¦ã€ç¤¾å†…æ–‡æ›¸ã®æƒ…å ±ã‚’ã‚‚ã¨ã«å›ç­”ã‚’å¾—ã‚‰ã‚Œã¾ã™ã€‚")
    st.sidebar.caption("ã€å…¥åŠ›ä¾‹ã€‘äººäº‹éƒ¨ã«æ‰€å±ã—ã¦ã„ã‚‹å¾“æ¥­å“¡æƒ…å ±ã‚’ä¸€è¦§åŒ–ã—ã¦")

# ============================================================
# ãƒ¡ã‚¤ãƒ³ç”»é¢ï¼ˆå³å´ï¼‰
# ============================================================

# ã‚°ãƒªãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆç·‘ãƒœãƒƒã‚¯ã‚¹ï¼‰
st.markdown(
    """
    <div style="background-color:#E8F5E9; padding:15px; border-radius:10px; margin-bottom:10px;">
        <b>ğŸ‘‹ ã“ã‚“ã«ã¡ã¯ã€‚</b><br>
        ç§ã¯ã€ç¤¾å†…æ–‡æ›¸ã®æƒ…å ±ã‚’ã‚‚ã¨ã«å›ç­”ã™ã‚‹ç”ŸæˆAIãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã§ã™ã€‚<br>
        ã‚µã‚¤ãƒ‰ãƒãƒ¼ã§åˆ©ç”¨ç›®çš„ã‚’é¸æŠã—ã€ç”»é¢ä¸‹éƒ¨ã®ãƒãƒ£ãƒƒãƒˆæ¬„ã‹ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã¦ãã ã•ã„ã€‚
    </div>
    """,
    unsafe_allow_html=True
)

# æ³¨æ„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆé»„è‰²ãƒœãƒƒã‚¯ã‚¹ï¼‰
st.markdown(
    """
    <div style="background-color:#FFF8E1; padding:15px; border-radius:10px; margin-bottom:20px;">
        âš ï¸ <b>å…·ä½“çš„ã«å…¥åŠ›ã—ãŸã»ã†ãŒæœŸå¾…é€šã‚Šã®å›ç­”ã‚’å¾—ã‚„ã™ã„ã§ã™ã€‚</b>
    </div>
    """,
    unsafe_allow_html=True
)

# ãƒãƒ£ãƒƒãƒˆå±¥æ­´
for msg in st.session_state.messages:
    with st.chat_message(msg["role"]):
        st.markdown(msg["content"])

# å…¥åŠ›æ¬„
user_input = st.chat_input("ã“ã¡ã‚‰ã‹ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã¦ãã ã•ã„ã€‚")

if user_input:
    st.session_state.messages.append({"role": "user", "content": user_input})
    with st.chat_message("user"):
        st.markdown(user_input)

    response = utils.handle_user_input(user_input)

    st.session_state.messages.append({"role": "assistant", "content": response})
    with st.chat_message("assistant"):
        st.markdown(response)
